# CheckCheck 그룹 기능 개선 진행 상황

**마지막 업데이트**: 2025-01-13

---

## 📊 전체 진행률: 약 26%

---

## Phase 1: MVP 완성 진행 상황

### 1. 코인 시스템 기본 (약 70% 완료)

#### ✅ 구현 완료
- **데이터 모델**
  - `CoinWallet.kt` - 코인 지갑 도메인 모델
    - `familyCoins`: 가족/그룹 내에서 받은 코인
    - `rewardCoins`: 시스템이 지급한 코인
    - `totalEarned`, `totalSpent`: 누적 통계
    - `totalCoins`: 계산 프로퍼티
  - `CoinTransaction.kt` - 거래 내역 모델
  - `TransactionType.kt` - 모든 거래 타입 정의
    - HABIT_REWARD, TASK_COMPLETION, CHALLENGE_REWARD
    - GIFT, COUPON_PURCHASE, COIN_CHARGE, AD_REWARD

- **Use Cases**
  - `GiftCoinsUseCase` - 그룹원끼리 코인 주고받기
  - `RewardHabitCompletionUseCase` - 습관 완료 보상
  - `GetCoinWalletUseCase` - 코인 지갑 조회
  - `GetCoinTransactionsUseCase` - 거래 내역 조회
  - `CreateCoinWalletUseCase` - 신규 사용자 지갑 생성

- **Repository & Data Layer**
  - `CoinRepository` 인터페이스
  - `CoinFirestoreRepository` - Firestore 연동 구현
  - `CoinWalletFirestoreDto` - Firestore DTO
  - `CoinTransactionFirestoreDto` - Firestore DTO

- **Presentation Layer**
  - `CoinWalletViewModel` - 뷰모델
  - `CoinWalletUiState` - UI 상태 관리

#### ❌ 미완성
- **UI 화면**
  - 코인 지갑 메인 화면 (`CoinWalletScreen.kt`)
  - 코인 내역 리스트 UI
  - 코인 선물하기 다이얼로그

- **비즈니스 로직**
  - 습관 7일 연속 달성 시 자동 코인 지급
  - 태스크 완료 시 코인 지급 연동
  - Firebase Functions를 통한 배치 작업

- **네비게이션**
  - 코인 지갑 화면 라우팅 추가

**위치**: `app/src/main/java/com/buyoungsil/checkcheck/feature/coin/`

---

### 2. 습관 구조 개편 (약 20% 완료)

#### ✅ 구현 완료
- **데이터 모델**
  - `Habit.kt` 모델에 그룹 공유 필드 추가
    - `groupShared: Boolean` - 그룹 공유 여부
    - `groupId: String?` - 공유된 그룹 ID
    - `isGroupChallenge: Boolean` - 그룹 챌린지 여부

#### ❌ 미완성
- **그룹원 습관 기능**
  - `HabitCheer` 데이터 모델 (응원 기능)
  - 그룹원 습관 섹션 UI (GroupMemberHabitsSection)
  - 그룹원별 습관 목록 화면
  - 습관 상세 보기 (연속 기록, 달성률)

- **습관 생성/수정 UI**
  - "그룹에 공유" 토글 스위치
  - 공유할 그룹 선택 UI

- **응원 기능**
  - 응원 이모지 버튼 (👏, 🔥, 💪, ❤️)
  - 응원 시 FCM 푸시 알림
  - `sendCheer()` UseCase
  - 응원 내역 저장/조회

- **Repository & UseCase**
  - `SendCheerUseCase`
  - `GetHabitCheersUseCase`
  - Firestore 저장 로직

**위치**: `app/src/main/java/com/buyoungsil/checkcheck/feature/habit/`

---

### 3. 그룹 권한 시스템 (약 40% 완료)

#### ✅ 구현 완료
- **데이터 모델**
  - `GroupMember.kt` - 그룹 멤버 모델
    - `role: MemberRole` 필드
  - `MemberRole` enum
    - OWNER (그룹장)
    - ADMIN (관리자)
    - MEMBER (일반 멤버)

- **그룹 기본 구조**
  - `Group.kt` - 그룹 모델
  - `GroupRepository` 및 구현체
  - `GroupMemberRepository` 및 구현체

#### ❌ 미완성
- **권한 시스템**
  - `MemberRole`에 GUEST 역할 추가 (문서와 불일치)
  - 또는 SUB_OWNER 역할 추가 검토
  - 역할별 권한 체크 로직
  - `GroupPermissionChecker` 유틸리티

- **멤버 관리 기능**
  - 멤버 관리 화면 UI
  - 역할 변경 (승급/강등) 기능
  - 멤버 추방 기능
  - 승급 요청 시스템 (`PromotionRequest` 모델)

- **자동 승급**
  - GUEST 자동 승급 배치 작업
  - 그룹 설정에 따른 자동 승급 로직

- **Use Cases**
  - `PromoteMemberUseCase`
  - `DemoteMemberUseCase`
  - `KickMemberUseCase`
  - `RequestPromotionUseCase`

**위치**: `app/src/main/java/com/buyoungsil/checkcheck/feature/group/`

---

### 4. 그룹 티어 & 확장 (0% - 미착수)

#### ❌ 전체 미구현
- **데이터 구조**
  - `GroupTier` enum 생성 필요
    - BASIC (10명, 무료)
    - STANDARD (20명, 50코인)
    - PREMIUM (50명, 100코인)
    - UNLIMITED (무제한, 200코인)

  - `TierBenefits` 데이터 클래스
  - `Group` 모델에 `tier` 필드 추가
  - `Group` 모델에 `currentMemberCount` 필드 추가

- **비즈니스 로직**
  - `UpgradeGroupTierUseCase`
  - 티어별 제한 체크 로직
  - 멤버 수 제한 검증
  - 코인 차감 및 트랜잭션

- **UI**
  - 그룹 티어 정보 표시
  - 티어 업그레이드 화면
  - 티어 비교 표
  - 멤버 제한 도달 경고

**예상 개발 기간**: 1주

---

### 5. 그룹 통계 시스템 (0% - 미착수)

#### ❌ 전체 미구현
- **데이터 구조**
  - `GroupStatistics` 모델
  - `StatisticsPeriod` enum (DAILY, WEEKLY, MONTHLY, ALL_TIME)
  - `MemberRank` 모델 (MVP 랭킹)
  - `StreakRank` 모델 (최장 연속 기록)
  - `ActivityRank` 모델 (활동량)
  - `HabitStats` 모델 (습관별 통계)

- **비즈니스 로직**
  - `GroupStatisticsService` 생성
  - `CalculateGroupStatsUseCase`
  - 완료 횟수 집계
  - 멤버별 활동 계산
  - 랭킹 생성 (Top 3/10)
  - 연속 기록 계산
  - 요일별/시간대별 활동 분석

- **캐싱**
  - `GroupStatisticsCache` 구현
  - 통계 캐싱 전략

- **UI**
  - 그룹 통계 메인 화면
  - 그룹 활동 요약 카드
  - MVP 랭킹 UI (Top 3)
  - 최장 연속 기록 UI
  - 상세 통계 화면 (탭 구성)
    - [개요] 탭
    - [멤버] 탭
    - [습관] 탭
    - [활동 패턴] 탭
  - 개인 vs 그룹 평균 비교

**예상 개발 기간**: 1.5주

---

## 📋 다음 단계 작업 우선순위

### High Priority (즉시 착수 가능)

#### 1주차: 코인 시스템 UI 완성
- [ ] `CoinWalletScreen.kt` 생성 (기본 화면)
- [ ] 코인 잔액 표시 UI
- [ ] 코인 거래 내역 리스트 UI
- [ ] 코인 선물하기 다이얼로그
- [ ] NavGraph에 코인 지갑 라우트 추가
- [ ] 홈 화면에서 코인 지갑 접근 버튼

**이유**: ViewModel과 UseCase가 이미 구현되어 있어서 UI만 만들면 바로 동작 가능

#### 2주차: 코인 자동 지급 로직
- [ ] 습관 체크 시 연속 기록 계산
- [ ] 7일 연속 달성 감지 로직
- [ ] `RewardHabitCompletionUseCase` 호출 연동
- [ ] 코인 지급 시 푸시 알림
- [ ] 태스크 완료 시 코인 지급 연동

**이유**: 코인 경제 순환의 핵심 기능

#### 3주차: 습관 그룹 공유 UI
- [ ] 습관 생성/수정 화면에 "그룹에 공유" 토글 추가
- [ ] 공유할 그룹 선택 UI
- [ ] 그룹 상세 화면에 "그룹원 습관" 섹션 추가
- [ ] 그룹원별 습관 목록 UI
- [ ] 습관 상세 보기 (연속 기록, 달성률)

**이유**: 데이터 필드는 준비되어 있어서 UI만 구현하면 됨

### Medium Priority

#### 4주차: 응원 기능
- [ ] `HabitCheer` 데이터 모델 생성
- [ ] `HabitCheerFirestoreDto` 생성
- [ ] `SendCheerUseCase` 구현
- [ ] 응원 버튼 UI (이모지 선택)
- [ ] FCM 푸시 알림 연동
- [ ] 응원 받은 횟수 표시

**이유**: 사용자 참여 유도 및 동기부여

#### 5주차: 그룹 티어 시스템
- [ ] `GroupTier` enum 생성
- [ ] `TierBenefits` 데이터 클래스
- [ ] `Group` 모델에 `tier` 필드 추가
- [ ] 기존 그룹 마이그레이션 (모두 BASIC)
- [ ] `UpgradeGroupTierUseCase` 구현
- [ ] 티어 제한 체크 로직
- [ ] 티어 업그레이드 UI
- [ ] 멤버 추가 시 티어 제한 검증

**이유**: 코인 소비처 제공, 그룹 성장 단계화

#### 6주차: 그룹 통계 기본
- [ ] `GroupStatistics` 모델 생성
- [ ] `MemberRank` 모델
- [ ] 완료 횟수 집계 로직
- [ ] Top 3 랭킹 계산
- [ ] 간단한 대시보드 UI
- [ ] 그룹 활동 요약 카드

**이유**: 그룹 활동 가시화, 경쟁 요소 추가

### Low Priority (나중에)

#### 7-8주차: 권한 시스템 강화
- [ ] GUEST 역할 추가 (또는 SUB_OWNER)
- [ ] 역할별 권한 체크 로직
- [ ] 멤버 관리 UI
- [ ] 승급/강등 기능
- [ ] 멤버 추방 기능

**이유**: MVP에서는 기본 권한만으로도 충분

---

## 🚧 현재 차단 이슈

### 없음
- 모든 기반 구조가 준비되어 있어서 즉시 개발 가능

---

## 📁 코드 구조 현황

### 구현된 주요 파일

```
feature/
├── coin/
│   ├── domain/
│   │   ├── model/
│   │   │   ├── CoinWallet.kt ✅
│   │   │   ├── CoinTransaction.kt ✅
│   │   │   └── TransactionType.kt ✅
│   │   ├── repository/
│   │   │   └── CoinRepository.kt ✅
│   │   └── usecase/
│   │       ├── CreateCoinWalletUseCase.kt ✅
│   │       ├── GetCoinWalletUseCase.kt ✅
│   │       ├── GetCoinTransactionsUseCase.kt ✅
│   │       ├── GiftCoinsUseCase.kt ✅
│   │       └── RewardHabitCompletionUseCase.kt ✅
│   ├── data/
│   │   ├── repository/
│   │   │   └── CoinFirestoreRepository.kt ✅
│   │   └── firebase/
│   │       ├── CoinWalletFirestoreDto.kt ✅
│   │       └── CoinTransactionFirestoreDto.kt ✅
│   └── presentation/
│       └── wallet/
│           ├── CoinWalletViewModel.kt ✅
│           ├── CoinWalletUiState.kt ✅
│           └── CoinWalletScreen.kt ❌ (미구현)
│
├── habit/
│   └── domain/
│       └── model/
│           └── Habit.kt ✅ (groupShared 필드 추가됨)
│
└── group/
    └── domain/
        └── model/
            ├── Group.kt ✅ (티어 필드 없음)
            └── GroupMember.kt ✅ (role 필드 있음)
```

### 생성 필요한 파일

```
feature/
├── coin/
│   └── presentation/
│       └── wallet/
│           └── CoinWalletScreen.kt ❌
│
├── habit/
│   ├── domain/
│   │   └── model/
│   │       └── HabitCheer.kt ❌
│   └── domain/
│       └── usecase/
│           └── SendCheerUseCase.kt ❌
│
├── group/
│   ├── domain/
│   │   └── model/
│   │       ├── GroupTier.kt ❌
│   │       ├── TierBenefits.kt ❌
│   │       └── GroupStatistics.kt ❌
│   └── domain/
│       └── usecase/
│           ├── UpgradeGroupTierUseCase.kt ❌
│           └── CalculateGroupStatsUseCase.kt ❌
│
└── statistics/
    └── presentation/
        └── group/
            └── GroupStatisticsScreen.kt ❌
```

---

## 📈 마일스톤

### Milestone 1: 코인 시스템 완성 (2주)
- 목표: 사용자가 코인을 확인하고 주고받을 수 있음
- 완료 기준:
  - [ ] 코인 지갑 UI 구현
  - [ ] 7일 연속 자동 코인 지급
  - [ ] 코인 선물 기능 동작
  - [ ] 코인 내역 확인 가능

### Milestone 2: 습관 공유 & 응원 (2주)
- 목표: 그룹원끼리 습관을 공유하고 응원할 수 있음
- 완료 기준:
  - [ ] 습관 그룹 공유 토글
  - [ ] 그룹원 습관 목록 보기
  - [ ] 응원 기능 동작
  - [ ] 응원 시 푸시 알림

### Milestone 3: 그룹 티어 & 통계 (2주)
- 목표: 그룹 확장 및 활동 통계 확인
- 완료 기준:
  - [ ] 그룹 티어 업그레이드
  - [ ] 멤버 수 제한 적용
  - [ ] 그룹 통계 기본 대시보드
  - [ ] MVP 랭킹 표시

---

## 🎯 Phase 1 완료 목표 KPI

- [ ] 코인 거래 활성화율: 60% 이상
- [ ] 그룹원 습관 조회율: 40% 이상
- [ ] 응원 기능 사용률: 50% 이상
- [ ] 그룹 통계 조회율: 70% 이상

---

## 📝 메모

### 기술 부채
1. `MemberRole` enum이 문서와 불일치
   - 코드: OWNER, ADMIN, MEMBER
   - 문서: OWNER, SUB_OWNER, MEMBER, GUEST
   - 결정 필요: ADMIN을 SUB_OWNER로 변경? 또는 GUEST만 추가?

2. 습관 7일 연속 자동 지급
   - Firebase Functions 사용 검토 필요
   - 또는 앱 내에서 체크 시마다 확인

3. 통계 계산 성능
   - 대규모 그룹 대비 캐싱 전략 필요
   - Firestore 쿼리 최적화

### 아키텍처 결정
- Clean Architecture 유지
- MVVM 패턴 일관성
- Repository Pattern으로 데이터 추상화
- Hilt 의존성 주입

---

## 📅 다음 업데이트 예정

- 다음 업데이트: 코인 UI 완성 후
- 예상 날짜: 2주 후
